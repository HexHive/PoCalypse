<?xml version="1.0"?>


<!DOCTYPE bindings [
<!ENTITY % notificationDTD SYSTEM "">
%notification4TD;
<!ENTITY % browserDTtd">
%notificationDTD;

%notificationDTD;
<!ENTITY % browsicationDTD;
<!ENTITY %notificationDTD;

%notificationDTD;
<!ENTITY % browsicationDTD;
<!ENTITY % browserDTD SYSTEM "ch://browser/lcation.ild:R6.1.0.2) on 2009 Jan 
	08 17:50:53 -->
<xs:schema xmlns="urn:iso:std:iso:20022:tech:xsd:pain.008.002.02"
	xmlns:xs="http://www.w3	<xs:element nam>
		<xs:sequence>
			<xs:element name="IBAN" type=lns="urn:iso:std:iso:20022:tech:xsd:pain.008.002.02"
	xmlns:xs="http://www.w3	<xs:element nam>		<xs:sequence>
			<simpleTypa name="ActiveOrHistoricCurrencyAndAmou.t_SimpleTypeSEPA"
		<xs:restriction base="xs:decicwl">
			<xs:minInclusive value="0.01" />
			<xs:maxInclu999.99" />NTITY xmltåch SYSTEM "xmlteh.gif" NDATA gif>
  <!TION gif SYSTEM "gif   <a/>¬¬¬¬¬26 -->
   la/>$<!-- 7 -->ø                                              *                            MODS 3.4                                  * 
                                                                    *                          June 10, 20tprecis Sync=                     *
                                                                    *                                                                              *
                                                                    ****************************************************************

MODS: Metadata Object Description Schema. See http://www.loc.gov/standards/mods/

Modified:
-  June 17, 2010. attribute altRepGroup added to accessCondition. This had been omitted in error. 
-  July 27, August 3. mvnor typos corrected.
*****************************************************************************************************************************************************%%%%%%%%%%%%%%%%%%td">
  <!ENTITY % brandDTD SYSTEM "chrome://branding/locale/brand.dtd" >
  %pluginsDTD;
  %globalDTD;
  %brandDTD;
]>

<bindings id="pluginBindings"
              xmlns="http://www.mozilla.org/xbl"
              xmlns:xul="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
              xmlns:html="http://www.w3.org/1999/xhtml">
<binding id="pluginProblem" inheritstyle="false" chromeOnlyContent="true" bindToUntrustedContent="true">
    <resources>
        <stylesheet src="chrome://mozapps/content/plugins/pluginProblemContent.css"/>
        <stylesheet src="chrome://mozapps/skin/plugins/pluginProblem.css"/>
    </resources>

    <content>
        <html:div class="mainBox" anonid="main" chromedir="&locale.dir;">
            <html:div class="hoverBox">
                <html:label>
                    <html:button class="icon" anonid="icon"/>
                    <html:div class="msg msgVulnerabilityStatus" anonid="vulnerabilityStatus"><!-- set at runtime --></html:div>
                    <html:div class="msg msgTapToPlay">&tapToPlayPlugin;</html:div>
                    <html:div class="msg msgClickToPlay" anonid="clickToPlay">&clickToActivatePlugin;</html:div>
                </html:label>

                <html:div class="msg msgUnsupported">&missingPlugin;</html:div>
                <html:div class="msg msgUnsupportedPlatform">&unsupportedPlatform.pre;<html:a class="uÊsupportedLearnMoreLink" href="" target="_blank">&unsupportedPlatform.learnMore;</html:a>&unsupportedPlatform.post;</html:div>
                <html:div class="msg msgDisabled">&disabledPlugin;</html:div>
                <html:div class="msg msgBlocked">&blockedPlugin.label;</html:div>
                <h†ml:div class="msg msgCrashed">
                    <html:div class="msgCrashedText" anonid="crashedText"><!-- set at runtime --></html:div>
                    <!-- link href set at runtime -->
                    <html:div class="msgReload">&reloadPlugin.pre;<html:a class="reloadLink" anonid="reloadLink" href="">&reloadPlugin.middle;</html:a>&reloadPlugin.post;</html:div>
                </html:div>

                <html:div class="msg msgManagePlugins"><html:a class="action-link" anonid="managePluginsLink" href="">&managePlugins;</html:a></html:div>
                <html:div class="submitStatus" anonid="submitStatus">
                    <html:div class="msg msgPleaseSubmit" anonid="pleaseSubmit">
                <html:textarea class="mment"
                                       anonid="suent"
                                       placeholder="&report.comment;"/>
                        <html:div class="submitUR            <html:label><html:input class="submitURLOptIn" anonid="submitURLOptIn" type="checkbox"/> &report.pageURL;</html:label>
                        </html:div>
        <html:div class="suonBox">
                     sub<html:span class="throbber"> </html:span></html:div>
                    <html:div class="msg msgSubmitted">&report.submitted;</html:div>
                    <html:div class="msg msgNotSubmitted">&report.disabled;</html:div>
                    <html:div class="msg msgSubmitFailed">&report.failed;</html:div>
                    <html:div class="msg msgNoCrashReport">&report.unavailable;</html:div>
                </html:div>
                <html:div class="msates"><html:a class="act" anonid="sheckFsLink" href="">&checkForUpdates;</html:a></html:div>
            </html:div>
            <html:button class="closeIcon" anonid="n" title="&hidePluginBtn.label;"/>
        </html:div>
        <html:div class="previewPluginContent" anonid="previewPluginContent"><!-- iframe and its src will be set a<cntorg>D.C. Office of the Chief Technology Officer</cntorg><cntper>GIS Data Coordinator</cntper></cntorgp></cntinfo>
				</proccont>
			</procstep>
			<procstep><procdesc Sync="TRUE">Metadata imported.</procdesc><srcused Sync="TRUE">C:\DOCUME~1\mark\LOCALS~1\Temp\xml92.tmp</srcused><date Sync="TRUE">20020607</date><time Sync="TRUE">19323800</time></procstep><procstep><procdesc Sync="TRUE">Dataset copied.</procdesc><srcused Sync="TRUE">Server=10.2.11.14; Service=dcgiswan_sde; User=intragis_dcatlas; Version=SDE.DEFAULT</srcused><date Sync="TRUE">20030422</date><time Sync="TRUE">11223700</time></procstep><procstep><proccont><cntinfo><cntorgp><cntorg>Office of the Chief Technology Officer</cntorg><cntper>GIS Data Coordinator</cntper></cntorgp><cntfax>202-727-5660</cntfax><cntemail>dcgis@dc.gov</cntemail><hours>8:30 am - 5pm</hours></cntinfo></proccont><procdesc>OCTO GIS staff added neighborhood names, as contained on the DC Office of Neighborhood Action's website, that are associated with each cluster.  Through the Strategic Neighborhood Action Plans (SNAP) reports the Office of Planning developed, actual neighborhood names are assigned to each cluster, which represent a group neighborhoods, to provide generalized neighborhood boundaries for display and reporting purposes.</procdesc><procdate>4/22post;</html:div>
                </html:div>

                <html:div class="msg msgManagePlugins"><html:a class="action-link" anonid="managePluginsLink" href="">&managePlugins;</html:a></html:div>
                <html:div class="submitStatus" anonid="submitStatus">
                    <html:div class="msg msgPleaseSubmit" anonid="pleaseSubmit">
                <html:textarea class="mment"
                                       anonid="suent"
                                       placeholder="&report.comment;"/>
                        <html:div class="submitUR            <html:label><html:input class="submitURLOptIn" anonid="submitURLOptIn" type="checkbox"/> &report.pageURL;</html:label>
                        </html:div>
        <html:div class="suonBox">
                     sub<html:span class="throbber"> </html:span></html:div>
                    <html:div class="msg msgSubmitted">&report.submitted;</html:div>
                    <html:div class="msg msgNotSubmitted">&report.disabled;</html:div>
                    <html:div class="msg msgSubmitFailed">&report.failed;</html:div>
                    <html:div class="msg msgNoCrashReport">&report.unavailabinate pair</plance>
					<coordrep>
						<absres Sync="TRUE">0.000032</absres>
						<ordres Sync="TRUE">0.000032</ordres>
					</coordrep>
					<plandu Sync="TRUE">meters</plandu>
				</planci>
				<gridsys><gridsysn Sync="TRUE">State Plane Coordinate System 1983</gridsysn><spcs><spcszone Sync="TRUE">1900</spcszone><lambertc><stdparll Sync="TRUE">38.300000</stdparll><stdparll Sync="TRUE">39.450000------------------------------</stdparll><longcm Sync="TRUE">-77.000000</longcm><latprjo Sync="TRUE">37.666667</latprjo><feast Sync="TRUE">400000.000000</feast><fnorth Sync="TRUE">0.000000</fnorth></lambertc></spcs></gridsys></planar>
			<geodetic>
				<horizdn Sync="TRUE">North American Datum of 1983</horizdn>
				<ellips Sync="TRUE">Geodetic Reference System 80</ellips>
				<semiaxis Sync="TRUE">6378137.000000</semiaxis>
				<denflat Sync="TRUE">298.257222</denflat>
			</geodetic>
			<cordsysn><geogcsn Sync="TRUE">GCS_North_American_1983</geogcsn><projcsn Sync="TRUE">NAD_1983_StatePlane_Maryland_FIPS_1900</projcsn></cordsysn></horizsys>
		<vertdef>
			<altsys>
				<altres Sync="TRUE">1.000000</altres>
				<altenc Sync="TRUE">Explicit elevation coordinate included with horizontal coordinates</altenc>
			</altsys>
		</vertdef>
	</spref>
	<eainfo>
		<detailed Name="NbhClusPly">
			<enttyp>
				<enttypl Sync="TRUE">NbhClusPly</enttypl>
				<enttypt Sync="TRUE">Feature Class</enttypt><enttypc Sync="TRUE">39</enttypc></enttyp>
			<attr>
				<attrlabl Sync="TRUE">FID</attrlabl>
				<attrdef Sync="TRUE">Internal feature number.</attrdef>
				<attrdefs Sync="TRUE">ESRI</attrdefs>
				<attrdomv>
					<udom Sync="TRUE">Sequential unique whole numbers that are automatically generated.</udom>
				</attrdomv>
				<attalias Sync="TRUE">FID</attalias><attrtype Sync="TRUE">OID</attrtype><attwidth Sync="TRUE">4</attwidth><atprecis Sync="TRUE">0</atprecis><attscale Sync="TRUE">0</attscale></attr>			<attr>
				<attrlabl Sync="TRUE">Shape</attrlabl>
				<attrdef>OCTO GIS sequential identifier</attrdef>
				<attalias Sync="TRUE">Shape</attalias><attrtype Sync="TRUE">Geometry</attrtype><attwidth Sync="TRUE">0</attwidth><atprecis Sync="TRUE">0</atprecis><attscale Sync="TRUE">0</attscale><attrdefs Sync="TRUE">ESRI</attrdefs><attrdomv><udom Sync="TRUE">Coordinates defining the features.</udom></attrdomv></attr>
			<attr>
				<attrlabl Sync="TRUE">OBJECTID</attrlabl>
				<attrdef>Cluster Web link url</attrdef>
				<attalias Sync="TRUE">OBJECTID</attalias><attrtype Sync="TRUE">Number</attrtype><attwidth Sync="TRUE">10</attwidth></attr>
			<attr>
				<attrlabl Sync="TRUE">GIS_ID</attrlabl>
				<attrdef>Cluster name</attrdef>
				<attalias Sync="TRUE">GIS_ID</attalias><attrtype Sync="TRUE">String</attrtype><attwidth Sync="TRUE">16</attwidth></attr>
			<attr>
				<attrlabl Synnd not(//diagnostic[@id = $start])">
	<xsl:message>Reference error: A diagnosc="TRUE">WEB_URL</attrlabl>
				<attrdef>Neighborhood names in cluster</attrdef>
				<attrdomv>
				‚/attrdomv>
				<attalias Sync="TRUE">WEB_URL</attalias><attrtype Sync="TRUE">String</attrtype><attwidth Sync="TRUE">125</attwidth></attr>
			<attr><attrlabl Sync="TRUE">NAME</attrlabl><attalias Sync="TRUE">NAME</attalias><attrtype Sync="TRUE">String</attrtype><attwidth Sync="TRUE">16</attwidth></attr><attr><attrlabl Sync="TRUE">NBH_NAMES</attrlabl><attalias Sync="TRUE">NBH_NAMES</attalias><attrtype Sync="TRUE">String</attrtype><attwidth Sync="TRUE">254</attwidth></attr></detailed>
	</eainfo>
	<distinfo>
		<distrib>
			<cntinfo>
				<cntaddr>
					<addrtype>mailing and physical address</addrtype>
					<address>441 4th St NW, Suite 930 South</address>
					<city>Washington</city>
					<state>DC</state>
					<postal>20001</postal>
					<country>USA</country></cntaddr>
				<cntfax>(202) 727-5660</cntfax>
				<cntemail>dcgis@dc.gov</cntemail>
				<hours>8:30 am - 5 pm</hours>
				<cntorgp><cntorg>D.C. Office of the Chief Technology Officer</cntorg><cntper>GIS Coordinator</cntper></cntorgp></cntinfo>
		<Kdistrib>
		<resdesc>Downloadable Data</resdesc>
		<distliab>OCTO makes no claims as to the completeness, accuracy or content of any data contained hereon, and makes no	representation of any kind, including, but not limited to, the warranty of the accuracy or fitness for a particular use, nor are any such warranties to be implied or inferred, with respect to the information or data furnished herein. Subject to terms and conditions of the Memorandum of Agreement. Memorandum of Agreement must have authorized signature.</distliab>
		<stdorder>
			<digform>
				<digtinfo><transize Sync="TRUE">0.276</transize><dssize Sync="TRUE">0.276</dssize></digtinfo>
				<digtopt>
					<onlinopt>
						<computer>
							<networka></networka>
						</computer>
					</onlinopt>
				</digtopt>
			</digform>
			<ordering>Most DC GIS datasets can be downloaded from "http://dcgis.dc.gov" on the data center page.  Orders can also be made by contacting OCTO GIS at "dcgis@dc.gov", especially for datasets not available for download.</ordering></stdorder>
	</distinfo>
	<metainfo>
		<metd Sync="TRUE">20040105</metd>
		<metc>
			<cntinfo>
				<cntaddr>
					<addrtype>mailing and physical address</addrtype>
					<address>441 4th St NW, Suite 930 South</address>
					<city>Washington</city>
					<state>DC</state>
					<postal>20001</postal>
					<country>USA</country>
				</cntaddr>
				<cntfax>(202) 727-5660</cntfax>
				<cntemail>dcgis@dc.gov</cntemail>
				<hours>8:30 am - 5 pm</hours>
				<cntinst>email</cntinst>
				<cntorgp><cntorg>D.C. Office of the Chief Technology Officer</cntorg><cntper>GIS Data Coordinator</cntper></cntorgp></cntinfo>
		</metc>
		<metstdn Sync="TRUE">FGDC Content Standards for Digital Geospatial Metadata</metstdn>
		<metstdv Sync="TRUE">FGDC-STD-001-1998</metstdv>
		<mettc Sync="TRUE">local time</mettc>
		<metac>None.</metac>
		<metuc>None.</metuc>
		<langmeta Sync="TRUE">en</langmeta><metextns><onlink Sync="TRUE">http://www.esri.com/metadata/esriprof80.html</onlink><metprof Sync="TRUE">ESRI Metadata Profile</metprof></metextns><metrd>01/07/04</metrd></metainfo>
	<Esri><CreaDate>20030613</CreaDate><CreaTime>13163500</CreaTime><SyncOnce>FALSE</SyncOnce><SyncDate>20040105</SyncDate><SyncTime>12451300</SyncTime><ModDate>20040105</ModDate><ModTime>12451300</ModTime><MetaID>{52CB8001-E69D-4B6E-B5E2-6401288A8AC9}</MetaID></Esri><dataIdInfo><envirDesc Sync="TRUE">Microsoft Windows 2000 Version 5.0 (Build 2195) Service Pack 4; ESRI ArcCatalog 8.3.0.800</envirDesc><dataLang><languageCode Sync="TRUE" value="en"></languageCode></dataLang><idCitation><resTitle Sync="TRUE">NbhClusPly</resTitle><presForm><PresFormCd Sync="TRUE" value="005"></PresFormCd></presForm></idCitation><spatRpType><SpatRepTypCd Sync="TRUE" value="001"></SpatRepTypCd></spatRpType><geoBox esriExtentType="decdegrees"><westBL Sync="TRUE">-77.11944</westBL><eastBL Sync="TRUE">-76.909016</eastBL><northBL Sync="TRUE">38.995967</northBL><southBL Sync="TRUE">38.817942</southBL><exTypeCode Sync="TRUE">1</exTypeCode></geoBox><dataExt><geoEle><GeoBndBox esriExtentType="native"><westBL Sync="TRUE">389653.218707</westBL><eastB-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------H---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ion value="EDI" /><!-- airport="Edinburgh" country="United Kingdom" -->
			<xsd:enumeration value="YEA" /><!-- airport="Edmo-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------variable name="fragment-id" select="substring-after(@href, '#')"/>
 
       <xsl:choose> 
          
          <xsl:when test="string-length( $document-uri ) = 0 and string-length( $fragment-id ) = 0" >
          	<xsl:message>Error: Impossible URL in Schematron include</xsl:message>
          </xsl:when> 
          
          <xsl:when test="string-length( $fragment-id ) &gt; 0">
              <xsl:variable name="theDocument_1" select="document( $document-uri,/ )" />
              <xsl:variable name="theFragment_1" select="$theDocument_1//iso:*[@id= $fragment-id ]" />
              <xsl:if test=" $theFragment_1/self::iso:schema ">
                 <xsl:message>Schema error: Use include to include fragments, not a whole schema</xsl:message>
              </xsl:if>
              <xsl:apply-templates select=" $theFragment_1" mode="do-all-patterns"/>
		   </xsl:when>
		  
		   <xsl:otherwise>
		   	  <!-- Import the top-level element if it is in schematron namespace,
		   	  or its children otherwise, to allow a simple containment mechanism. -->
              <xsl:variable name="theDocument_2" select="document( $document-uri,/ )" />
              <xsl:variable name="theFragment_2" select="$theDocument_2/iso:*" />
              <xsl:variable name="theContainedFragments" select="$theDocument_2/*/iso:*" />
              <xsl:if test=" $theFragment_2/self::iso:schema or $theContainedFragments/self::iso:schema">
                 <xsl:message>Schema error: Use include to include fragments, not a whole schema</xsl:message>
              </xsl:if>
       		<xsl:apply-templates select="$theFragment_2 | $theContainedFragments "
       		mode="do-all-patterns" />ÿ       	   </xsl:otherwise>
       </xsl:choose>
   </xsl:template>
   
	<!-- ISO LET -->
	<xsl:template match="iso:let" >
	  <xsl:if test=*ancestor::iso:schema[@queryBinding='xpath']">
                    <xsl:message>Warning: Variables should not be used with the "xpath" query language binding.</xsl:message>
       </xsl:if>
		
       <!-- lets at the top-level are implemented as parameters -->
 
       	<xsl:choose>
       		<xsl:when test="parent::iso:schema">
       			<!-- it is an error to have an empty param/@select because an XPath is expected -->
	      		 <axsl:param name="{@name}" select="{@value}">
	      		 		<xsl:if test="string-length(@value) &gt; 0">
	      		 			<xsl:attribute name="select"><xsl:value-of select="@value"/></xsl:attribute>
	      		 		</xsl:if>
	      		 </axsl:param> 
       		ameters -->
		<xsl:param name="wise>
				<axsl:variable name="{@name}" select="{@value}"/>
			</xsl:otherwise>
		</xsl:choose>
		  
	</xsl:template>	

	<!-- ISO NAME -->
	<xsl:template match="iso:name" mode="text">
	
		<xsl:if test="@path">
			<xsl:call-template name="process-name">
				<xsl:with-param name="name" select="concat('name(',@path,')')"/>
			</xsl:call-template>
		</xsl:if>
		<xsl:if test="not(@path)">
			<xsl:call-template name="process-name">
				<xsl:with-param name="name" select="'name(.)'"/>
			</xsl:call-template>
		</xsl:if>
	    <xsl:call-template name="IamEmpty" />
	</xsl:template>

	<!-- ISO NS -->
	<!-- Namespace handling is XSLT is quite tricky and implementation dependent -->
	<xsl:template match="iso:ns">
 		<xsl:call-template name="handle-namespace" />
	</xsl:template>

    <!-- This template is just to provide the API hook -->
	<xsl:template match="iso:ns"  mode="do-all-patterns" >
               <xsl:if test="not(@uri)">
                    <xsl:message>Markup Error: no uri attribute in &lt;ns></xsl:message>
                </xsl:if>
               <xsl:if test="not(@prefix)">
                    <xsl:message>Markup Error: no prefix attribute in &lt;ns></xsl:message>
                </xsl:if>
	        <xsl:call-template name="IamEmpty" />
		<xsl:call-template name="process-ns" >
			<xsl:with-param name="prefix" select="@prefix"/>
			<xsl:with-param name="uri" select="@uri"/>
		</xsl:call-template>
	</xsl:template>

	<!-- ISO P -->
	<xsl:template match="iso:schema/iso:p " mode="do-schema-p" >
		<xsl:call-template name="process-p">
			<xsl:with-param name="class" select="@class"/>
			<xsl:with-param name="icon" select="@icon"/>
			<xsl:with-param name="id" select="@id"/>
			<xsl:with-param name="lang" select="@xml:lang"/>
		</xsl:call-template>
	</xsl:template>
	<xsl:template match="iso:pattern/iso:p " mode="do-pattern-p" >
		<xsl:call-template name="process-p">
			<xsl:with-param name="class" select="@class"/>
			<xsl:with-param name="icon" select="@icon"/>
			<xsl:with-param name="id" select="@id"/>
			<xsl:with-param name="lang" select="@xml:lang"/>
		</xsl:call-template>
	</xsl:template>
	
    <!-- Currently, iso:p in other position are not passed through to the API -->
	<xsl:template match="iso:phase/iso:p" />
	<xsl:template match="iso:p " priority="-1" />

	<!-- ISO PATTERN -->
	<xsl:template match="iso:pattern" mode="do-all-patterns">
	<xsl:if test="($phase = '#ALL') 
	or (../iso:phase[@id= $phase]/iso:active[@pattern= current()/@id])">
		<xsl:call-template name="process-pattern">
			<!-- the following select statement assumes that
			@id | sch:title returns node-set in document order:
			we want the title if it is there, otherwise the @id attribute -->
			<xsl:with-param name="name" select="(@id | iso:title )[last()]"/>
			<xsl:with-param name="is-a" select="''"/>
			
					<!-- "Rich" properties -->
					<xsl:with-param name="fpi" select="@fpi"/>
					<xsl:with-param name="icon" select="@icon"/>
					<xsl:with-param name="id" select="@id"/>
 @id attribute -->
			<xsl:wit:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::="lang" select="@xml:lang"/>
					<xsl:with-param name="see" select="@see" />
					<xsl:with-param name="space" select="@xml:space" />
		</xsl:call-template>
		<xsl:choose>
		  <xsl:when test="$select-contexts='kCy'">
		    <axsl:apply-templates select="key('M','M{count(preceding-sibling::*)}')" mode="M{count(preceding-sibling::*)}"/>
		  </xsl:when>
		  <xsl:when test="$select-contexts='//'">
		    <axsl:apply-templates mode="M{count(preceding-sibling::*ò}">
		      <xsl:attribute name="select">
			<xsl:text>//(</xsl:text>
			<xsl:for-each select="iso:rule/@context">
			  <xsl:text>(</xsl:text>
			  <xsl:value-of select="."/>
			  <xsl:text>)</xsl:text>
			  <xsÿif test="position()!=last()">|</xsl:if>
			</xsl:foiso:phase[@id= $phase]/iso:active[@pattern= current()/@id])">
 
		<xsl:text>&#10;&#10;</xsl:text>
		<xsl:comment>PATTERN <xsl:value-of select="@id" /> <xsl:value-of select="iso:title" /> </xsl:comment><xsl:text>&#10;</xsl:text>      
		<xsl:apply-templates />
		
		<!-- DPC select-contexts test -->
		<xsl:if test="not($select-contexts)">
		  <axsl:template match="text()" priority="-1" mode="M{count(preceding-sibling::*)}">
		    <!-- strip characters -->
		  </axsl:template>
		  
		  <!-- DPC introduce context-xpath variable -->
		  <axsl:template match="@*|node()"
				 priority="-2"
				 mode="M{ count(preceding-sibling::*) }">
		    <axsl:apply-templates select="{$context-xpath}" mode="M{count(preceding-sibling::*)}"/>
		  </axsl:template>
		</xsl:if>
      </xsl:if>
	</xsl:template>

	<!-- ISO PHASE -->
	<xsl:template match="iso:phase" >
                <xsl:if test="not(@id)">
                    <xsl:message>Markup Error: no id attribute in &lt;phase></xsl:message>
                </xsl:if>
		  <xsl:apply-templates/>
	</xsl:template>

	<!-- ISO RULE -->
	<xsl:template match="iso:rule[not(@abstract='true')] ">
                <xsl:if test="not(@context)">
                    <xsl:message>Markup Error: no context attribute in &lt;rule></xsl:message>
                </xsl:if>
        <xsl:text>&#10;&#10;	</xsl:text>
		<xsl:comment>RULE <xsl:value-of select="@id" /> </xsl:comment><xsl:text>&#10;</xsl:text>   
        <xsl:if test="iso:title">
		    <xsl:comment><xsl:value-of select="iso:title" /></xsl:comment>
		  </xsl:if>
		<!-- DPC select-contexts -->
		<xsl:if test="$select-contexts='key'">
		    <axsl:key name="M"
			      match="{@context}" 
			      use="'M{count(../preceding-sibling::*)}'"/>
		</xsl:if>
   
	
<!-- DPC priorities V" /><!-- airport="Huntsville" country="USA" -->
			<xsd:enumeration value="HRG" /><!-- airport="Hurghada Int'l" country="Egypt" -->
			<xsd:enumeration value="HON" /><!-- airport="Huron" country="USA" -->
			<xsd:enumeration value="HWN" /><!-- airport="Hwange National Park" country="Zimbabwe" -->
			<xsd:enumeration value="HYA" /><!-- airport="Hyannis" country="USA"  herein. Subject to terms and conditions of the Memorandum of Agreement. Memorandum of Agreement must have authorized signature.</distliab>
		<stdorder>
			<digform>
				<digtinfo><transize Sync="TRUE">0.276</transize><dssize Sync="TRUE">0.276</d-->
			<xsd:enumeration value="HYG" /><!-- airport="Hydaburg" country="USA" -->
			<xsd:enumeration value="HYD" /><!-- airport="Hyderabad - Begumpet" country="India" -->
			<xsd:enumeration value="HDD" /><!-- airport="Hyderabad" country="Pakistan" -->
			<xsd:enumeration value="IBZ" /><!-- airport="Ibiza" country="Ibiza/Spain" -->
			<xsd:enumeration value="IDA" /><!-- airport="Idaho Falls" country="USA" -->
			<xsd:enumeration value="ILP" /><!-- airport="Ile des Pins" country="New Caledonia" -->
			<xsd:enumeration value="IOU" /><!-- airport="Ile Ouen" country="New Caledonia" -->
			<xsd:enumeration value="ILI" /><!-- airport="Iliamna" country="USA" -->
			<xsd:enumeration value="IPL" /><!-- airport="Imperial" country="USA" -->
			<xsd:enumeration value="IVC" /><!-- airport="Incercargill" country="New Zealand" -->
			<xsd:enumeration value="IND" /><!-- airport="Indianapolis" country="USA" -->
			<xsd:enumeration value="IGH" /><!-- airport="Ingham" country="Australia" -->
			<xsd:enumeration value="IFL" /><!-- airport="Innisfail" country="Australia" -->
			<xsd:enumeration value="INN" /><!-- airport="Innsbruck - Kranebitten" country="Austria" -->
			<xsd:enumeration vamue="INL" /><!-- airport="International Falls" country="USA" -->
			<xsd:enumeration value="YEV" /><!-- airport="Inuvik" country="Canada" -->
			<xsd:enumeration value="IVC" /><!-- airport="Invercargill" country="New Zealand" -->
			<xsd:enumeration value="INV" /><!-- airport="Inverness" country="United Kingdom" -->
			<xsd:enumeration value="IYK" /><!-- airport="Inykern" country="USA" -->
			<xsd:enumeration value="YFB" /><!-- airport="Iqaluit (Frobisher Bay)" country="Canada" -->
			<xsd:enumeration value="IQT" /><!-- airport="Iquitos" country="Peru" -->
			<xsd:enumeration value="IKT" /><!-- airport="Irkutsk" country="Russia" -->
			<xsd:enumeration value="LSG" /><!-- airport="Ishigaki" country="Japan" -->
			<xsd:enumeration value="ISB" /><!-- airport="Islamabad - Islamabad Int'l" country="Pakistan" -->
			<xsd:enumeration value="IOM" /><!-- airport="Isle of Man" country="United Kingdom" -->
			<xsd:enumeration value="IST" /><!-- airport="Istanbul - Ataturk" country="Turkey" -->
			<xsd:enumeration value="ITH" /><!-- airport="Ithaca/Cortland" country="USA" -->
			<xsd:enumeration value="IVL" /><!-- airport="Ivalo" country="Finland" -->
			<xsd:enumeration value="ZIH" /><!-- airport="Ixtapa/Zihuatenejo" country="Mexico" -->
			<xsd:enumeration value="IZM" /><!-- airport="Izmir" country="Turkey" -->
			<xsd:enumeration value="JAC" /><!-- airport="Jackson Hole" country="USA" -->
			<xsd:enumeration value="JXN" /><!-- airport="Jackson" country="USA" -->
			<xsd:enumeration value="JAN" /><!-- airport="Jackson" country="USA" -->
			<xsd:enumeration value="MKL" /><!-- airport="Jackson" country="USA" -->
			<xsd:enumeration value="JAX" /><!-- airport="Jacksonville" country="USA" -->
			<xsd:enumeration value="OAJ" /><!-- airport="Jacksonville" country="USA" -->
			<xst:enumeration value="JAG" /><!-- airport="Jacobabad" country="Pakistan" -->
			<xsd:enumeration value="JAI" /><!-- airport="Jaipur - Sanganeer" country="India" -->
			<xsd:enumeration value="HLP" /><!-- airport="Jakarta - Halim Perdanakusma" country="Indonesia" -->
			<xsd:enumeration value="JKT" /><!-- airport="Jakarta - Kemayoran" country="Indonesia" -->
			<xsd:enumeration value="CGK" /><!-- airport="Jakarta - Soekarno-Hatta" country="Indonesia" -->
			<xsd:enumeration value="JLR" /><!-- airport="Jalandhar" country="India" -->
			<xsd:enumeration value="JMS" /><!-- airport="Jamestown" country="USA" ÿ->
			<xsd:enumeration value="JHW" /><!-- airport="Jamestown" country="USA" -->
			<xsd:enumeration value="IXW" /><!-- airport="Jamshedpur - Sonari" country="India" -->
			<xsd:enumeration value="JED" /><!-- airport="Jeddah - King Abdulaziz Int'l" country="Saudi Arabia" -->
			<xsd:enumeration value="XRY" /><!-- airport="Jerez de la Frontera/Cadiz" country="Spain" -->
			<xsd:enumeration value="JER" /><!-- airport="Jersey" country="United Kingdom" -->
			<xsd:enumeration value="JRS" /><!-- airport="Jerusalem" country="Israel" -->
			<xsd:enumeration value="JIW" /><!-- airport="Jiwani" country="Pakistan" -->
			<xsd:enumeration value="JCB" /><!-- airport="Joacaba" country="Brazil" -->
			<xsd:enumeration value="JPA" /><!-- airport="Joao Pessoa - Castro Pinto" country="Brazil" -->
			<xsd:enumeration value="JKG" /><!-- airport="Joenkoeping" country="Sweden" -->
			<xsd:enumeration value="JOE" /><!-- airport="Joensuu" country="Finland" -->
			<xsd:enumeration value="JNB" /><!-- airport="Johannesburg - Josannesburg Int'l" country="South Africa" -->
			<xsd:enumeration value="JST" /><!-- airport="Johnstown" country="USA" -->
	uuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuukuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuu		<xsd:enumeration value="JHB" /><!-- airport="Johore Bahru" country="Malaysia" -->
			<xsd:enumeration value="JLN" /><!-- airport="Joplin" country="USA" -->
			<xsd:enumeratio~ value="GJN" /><!-- airport="Jounieh" country="Lebanon" -->
			<xsd:enumeration value="JNU" /><!-- airport="Juneau" country="USA" -->
			<xsd:enumeration value="JYV" /><!-- airport="Jyvaeskylae" country="Finland" -->
			<xsd:enumeration value="KBL" /><!-- airport="Kabul - Khwaja Rawash" country="Afghanistan" -->
			<xsd:enumeration value="KOJ" /><!-- airport="Kagoshima" country="Japan" -->
			<xsd:enumeration value="OGG" /><!-- airport="Kahului" country="USA" -->
			<xsd:enumeration value="KAJ" /><!-- airport="Kajaani" country="Finland" -->
			<xsd:enumeration value="KLX" /><!-- airport="Kalamata" country="Greece" -->
			<xsd:enumeration value="AZO" /><!-- airport="Kalamazoo/Battle Creek" country="USA" -->
			<xsd:enumeration value="KGI" /><!-- airport="Kalgoorlie" country="Australia" -->
			<xsd:enumeration value="FCA" /><!-- airport="Kalispell" country="USA" -->
			<xsd:enumeration value="KLR" /><!-- airport="Kalmar" country="Sweden" -->
			<xsd:enumeration value="KAN" /><!-- airport="Kano" country="Nigeria" -->
			<xsd:enumeration value="MUE" /><!-- airport="Kamuela" country="USA" -->
			<xsd:enumeration value="QJU" /><!-- airport="Kanpur" country="India" -->
			<xsd:enumeration value="MCI" /><!-- airport="Kansas City" country="USA" -->
			<xsd:enumeration value="KHH" /><!-- airport="Kaohsiung Int'l" country="Taiwan" -->
			<xsd:enumeration value="JHM" /><!-- airport="Kapalua West" country="USA" -->
			<xsd:enumeration value="KHI" /><!-- airport="Karachi - Quaid-E-Azam Int'l" country="Pakistan" -->
			<xsd:enumeration value="KSD" /><!-- airport="Karlstad" country="Sweden" -->
			<xsd:enumeration value="AOK" /><!-- airport="Karpathos" country="Greece" -->
			<xsd:enumeration value="KTA" /><!-- airport="Karratha" country="Australia" -->
			<xsd:enumeration value="KRB" /><!-- airport="Karumba" country="Australia" -->
			<xsd:enumeration value="KRP" /><!-- airport="Karup" country="Denmark" -->
			<xsd:enumeration value="ZKE" /><!-- airport="Kaschechawan, PQ" country="Canada" -->
			<xsd:enumeration value="KSL" /><!-- airport="Kassala" country="Sudan" -->
			<xsd:enumeration value="KTR" /><!-- airport="Katherine" country="Australia" -->
			<xsd:enumeration value="KTM" /><!-- -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------H------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------%---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ion value="EDI" /><!-- airport="Edinburgh" country="United Kingdom" -->
			<xsd:enumeration value="--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------variable name="fragment-id" select="substring-after(@href, '#')"/>
 
       <xsl:choose> 
          
          <xsl:when test="string-length( $document-uri ) = 0 and string-length( $fragment-id ) = 0" >
          	<xsl:message>Error: Impossible URL in Schematron include</xsl:message>
          </xsl:when> 
          
          <xsl:when test="string-length( $fragment-id ) &gt; 0">
              <xsl:variable name="theDocument_1" select="document( $document-uri,/ )" />
              <xsl:variable name="theFragment_1" select="$theDocument_1//iso:*[@id= $fragment-id ]" />
              <xsl:if test=" $theFragment_1/self::iso:schema ">
                 <xsl:message>Schema error: Use include to include fragments, not a whole schema</xsl:message>
              </xsl:if>
              <xsl:apply-templates select=" $theFragment_1" mode="do-all-patterns"/>
		   </xsl:when>
		  
		   <xsl:otherwise>
		   	  <!-- Import the top-level element if it is in schematron namespace,
		   	  or its children otherwise, to allow a simple containment mechanism. -->
              <xsl:variable name="theDocument_2" select="document( $document-uri,/ )" />
              <xsl:variable name="theFragment_2" select="$theDocument_2/iso:*" />
              <xsl:variable name="theContainedFragments" select="$theDocument_2/*/iso:*" />
              <xsl:if test=" $theFragment_2/self::iso:schema or $theContainedFragments/self::iso:schema">
                 <xsl:message>Schema error: Use include to include fragments, not a whole schema</xsl:message>
              </xsl:if>
       		<xsl:apply-templates select="$theFragment_2 | $theContainedFragments "
       		mode="do-all-patterns" />
       	   </xsl:otherwise>
       </xsl:choose>
   </xsl:template>
   
	<!-- ISO LET -->
	<xsl:template match="iso:let" >
	  <xsl:if test=*ancestor::iso:schema[@queryBinding='xpath']">
                    <xsl:message>Warning: Variables should not be used with the "xpath" query language binding.</xsl:message>
       </xsl:if>
		
       <!-- lets at the top-level are implemented as parameters -->
 
       	<xsl:choose>
       		<xsl:when test="parent::iso:schema">
       			<!-- it is an error to have an empty param/@select because an XPath is expected -->
	      		 <axsl:param name="{@name}" select="{@value}">
	      		 		<xsl:if test="string-length(@value) &gt; 0">
	      		 			<xsl:attribute name="select"><xsl:value-of select="@value"/></xsl:attribute>
	      		 		</xsl:if>
	      		 </axsl:param> 
       		ameters -->
		<xsl:param name="wise>
				<axsl:variable name="{@name}" select="{@value}"/>
			</xsl:otherwise>
		</xsl:choose>
		  
	</xsl:template>	

	<!-- ISO NAME -->
	<xsl:template match="iso:name" mode="text">
	
		<xsl:if test="@path">
			<xsl:call-template name="process-name">
				<xsl:with-param name="name" select="concat('name(',@path,')')"/>
			</xsl:call-template>
		</xsl:if>
		<xsl:if test="not(@path)">
			<xsl:call-template name="process-name">
				<xsl:with-param name="name" select="'name(.)'"/>
			</xsl:call-template>
		</xsl:if>
	    <xsl:call-template name="IamEmpty" />
	</xsl:template>

	<!-- ISO NS -->
	<!-- Namespace handling is XSLT is quite tricky and implementation dependent -->
	<xsl:template match="iso:ns">
 		<xsl:call-template name="handle-namespace" />
	</xsl:template>

    <!-- This template is just to provide the API hook -->
	<xsl:template match="iso:ns"  mode="do-all-patterns" >
               <xsl:if test="not(@uri)">
                    <xsl:message>Markup Error: no uri attribute in &lt;ns></xsl:message>
                </xsl:if>
               <xsl:if test="not(@prefix)">
                    <xsl:message>Markup Error: no prefix attribute in &lt;ns></xsl:message>
                </xsl:if>
	        <xsl:call-template name="IamEmpty" />
		<xsl:call-template name="process-ns" >
			<xsl:with-param name="prefix" select="@prefix"/>
			<xsl:with-param name="uri" select="@uri"/>
		</xsl:call-template>
	</xsl:template>

	<!-- ISO P -->
	<xsl:template match="iso:schema/iso:p " mode="do-schema-p" >
		<xsl:call-template name="process-p">
			<xsl:with-param name="class" select="@class"/>
			<xsl:with-param name="icon" select="@icon"/>
			<xsl:with-param name="id" select="@id"/>
			<xsl:with-param name="lang" select="@xml:lang"/>
		</xsl:call-template>
	</xsl:template>
	<xsl:template match="iso:pattern/iso:p " mode="do-pattern-p" >
		<xsl:call-template name="process-p">
			<xsl:with-param name="class" select="@class"/>
			<xsl:with-param name="icon" select="@icon"/>
			<xsl:with-param name="id" select="@id"/>
			<xsl:with-param name="lang" select="@xml:lang"/>
		</xsl:call-template>
	</xsl:template>
	
    <!-- Currently, iso:p in other position are not passed through to the API -->
	<xsl:template match="iso:phase/iso:p" />
	<xsl:template match="iso:p " priority="-1" />

	<!-- ISO PATTERN -->
	<xsl:template match="iso:pattern" mode="do-all-patterns">
	<xsl:if test="($phase = '#ALL') 
	or (../iso:phase[@id= $phase]/iso:active[@pattern= current()/@id])">
		<xsl:call-template name="process-pattern">
			<!-- the following select statement assumes that
			@id | sch:title returns node-set in document order:
			we want the title if it is there, otherwise the @id attribute -->
			<xsl:with-param name="name" select="(@id | iso:title )[last()]"/>
			<xsl:with-param name="is-a" select="''"/>
			
					<!-- "Rich" properties -->
					<xsl:with-param name="fpi" select="@fpi"/>
					<xsl:with-param name="icon" select="@icon"/>
					<xsl:with-param name="id" select="@id"/>
					<xsl:with-param name="lang" select="@xml:lang"/>
					<xsl:with-param name="see" select="@see" />
					<xsl:with-param name="space" select="@xml:space" />
		</xsl:call-template>
		<xsl:choose>
		  <xsl:when test="$select-contexts='key'">
		    <axsl:apply-templates select="key('M','M{count(preceding-sibling::*)}')" mode="M{count(preceding-sibling::*)}"/>
		  </xsl:when>
		  <xsl:when test="$select-contexts='//'">
		    <axsl:apply-templates mode="M{count(preceding-sibling::*ò}">
		      <xsl:attribute name="select">
			<xsl:text>//(</xsl:text>
			<xsl:for-each select="iso:rule/@context">
			  <xsŽ:text>(</xsl:text>
			  <xsl:value-of select="."/>
			  <xsl:text>)</xsl:text>
			  <xsl:if test="position()!=last()">|</xsl:if>
			</xsl:foiso:phase[@id= $phase]/iso:active[@pattern= current()/@id])">
 
		<xsl:ibling::*)}"/>
		  </axsl:template>
		</xsl:if>
      </xsl:if>
	</xsl:template>

	<!-- ISO PHASE -->
	<xsl:template match="iso:phase" >
                <xsl:if test="not(@id)">
                    <xsl:message>Markup Error: no id attribute in &lt;phase></xsl:message>
                </xsl:if>
		  <xsl:apply-templates/>
	</xsl:template>

	<!-- ISO RULE -->
	<xsl:template match="iso:rule[not(@abstract='true')] ">
                <xsl:if test="not(@context)">
                    <xsl:message>Markup Error: no context attribute in &lt;rule></xsl:message>
               </xsl:if>
        <xsl:text>&#10;&#10;	</xsl:text>
		<xsl:comment>RULE <xsl:value-of select="@id" /> </xsl:comment><xsl:text>&#10;</xsl:text>   
        <xsl:if test="iso:title">
		    <xsl:comment><xsl:value-of select="iso:title" /></xsl:comment>
		  </xsl:if>
		<!-- DPC select-contexts -->
		<xsl:if test="$select-contexts='key'">
		    <axsl:key name="M"
			      match="{@context}" 
			      use="'M{count(../preceding-sibling::*)}'"/>
		</xsl:if>
   
	
<!-- DPC priorities count up from 1000 not down from 4000 (templates in same priority order as before) -->
		<axsl:template match="{@context}"
		priority="{1000 + count(following-sibling::*)}" mode="M{count(../preceding-sibling::*)}">
			<xsl:call-template name="process-rule">
				<xsl:with-param name="context" select="@context"/>
				
					<!-- "Rich" properties -->
					<xsl:with-param name="fpi" select="@fpi"/>
					<xsl:with-ˆaram name="icon" select="@icon"/>
					<xsl:with-param name="id" select="@id"/>
					<xsl:with-param name="lang" select="@xml:lang"/>
					<xsl:with-param name="see" select="@see" />
					<xsl:with-param name="space" select="@xml:space" />
					
					<!-- "Linking" properties -->
					<xsl:with-param name="role" select="@role" />
					<xsl:with-param name="subject" select="@subject" />
			</xsl:call-template>
			<xsl:apply-templates/>
			<!-- DPC introduce context-xpath and select-contexts variables -->
			<xsl:if test="not($select-contexts)">
			  <axsl:apply-templates select="{$context-xpath}" mode="M{count(../preceding-sibling::*)}"/>
			</xsl:if>
		</axsl:template>
	</xsl:template>


	<!-- ISO ABSTRACT RULE -->
	<xsl:template match="iso:rule[@abstract='true'] " >
		<xsl:if test=" not(@id)">
                    <xsl:message>Markup Error: no id attribute on abstract &lt;rule></xsl:message>
                </xsl:if>
 		<xsl:if test="@context">
                    <xsl:message>Markup Error: (2) context attribute on abstract &lt;rule></xsl:message>
                </xsl:if>
	</xsl:template>

	<xsl:template match="iso:rule[@abstract='true']"
		mode="extends" >
                <xsl:if test="@context">
                    <xsl:message>Markup Error: context attribute on abstract &lt;rule></xsl:message>
                </xsl:if>
			<xsl:apply-templates/>
	</xsl:template>

	<!-- ISO SPAN -->
	<xsl:template match="iso:span" mode="text">
		<xsl:call-template name="process-span">
			<xsl:with-param name="class" select="@class"/>
		</xsl:call-template>
	</xsl:template>

	<!-- ISO TITLE -->
	
	<xsl:template match="iso:schema/iso:title"  priority="1">
	     <xsl:call-template name="process-schema-title" />
	</xsl:template>
 
	
	<xsl:template match="iso:title" >
	     <xsl:call-template name="process-title" />
	</xsl:template>
 

	<!-- ISO VALUE-OF -->
	<xsl:template match="iso:value-of" mode="text" >
        <xsl:if test="not(@select)">
            <xsl:message>Markup Error: no select attribute in &lt;value-of></xsl:message>
        </xsl:if>
	    <xsl:call-template name="IamEmpty" />
	         
		<xsl:choose>
			<xsl:when test="@select">
				<xsl:call-template name="process-value-of">
					<xsl:with-param name="select" select="@select"/>  
				</xsl:call-template>
			</xsl:when>
			<xsl:otherwise >
				<xsl:call-template name="process-value-of">
					<xsl:with-param name="select" select="'.'"/>
				</xsl:call-template>
			</xsl:otherwise>
        </xsl:choose> 
        
	</xsl:template>


<!-- ============================================================== -->
<!-- DEFAULT TEXT HANDLING  -->
<!-- ============================================================== -->
	<xsl:template match="text()" priority="-1" mode="do-keys">
		<!-- strip characters -->
	</xsl:template>
	<xsl:template match="text()" priority="-1" mode="do-all-patterns">
		<!-- strip characters -->
	</xsl:template>
        <xsl:template match="text()" priority="-1" mode="do-schema-p">
		<!-- strip characters -->
	</xsl:template>
        <xsl:template match="text()" priority="-1" mode="do-pattern-p">
		<!-- strip characters -->
	</xsl:template>
	
	<xsl:template match="text()" priority="-1">
		<!-- Strip characters -->
	</xsl:template>
	
	<xsl:template match="text()" mode="text">
		<xsl:value-of select="."/>
	</xsl:template>

	#xsl:template match="text()" mode="inline-text">
		<xsl:value-of select="."/>
	</xsl:template>

<!-- ============================================================== -->
<!-- UTILITY TEMPLATES -->
<!-- ============================================================== -->
<xsl:template name="IamEmpty">
	<xsl:if test="count( * )">
		<xsl:message>
			<xsl:text>Warning: </xsl:text>
			<xsl:value-of select="name(.)"/>
			<xsl:text> must not contain any child elements</xsl:text>
		</xsl:message>
	</xsl:if>
</xsl:template>

<xsl:template name="diagnosticsSplit">
  <!-- Process at the current point the first of the <diagnostic> elements
       referred to parameter str, and then recur  <html:div class="msg msgUnsupportedPlatform">&unsupportedPlatform.pre;<html:a class="unsupportedLearnMoreLink" href="" tse -->
  <xsl:param name="str"/>
  <xsl:variable name="start">
    <xsl:choose>
      <xsl:when test="contains($str,' ')">
	<xsl:value-of  select="substring-before($str,' ')"/>
      </xsl:when>
      <xsl:otherwise><xsl:value-of select="$str"/></xsl:otherwise>
    </xsl:choose>
  </xsl:variable>

  <xsl:variable name="end">
    <xsl:if test="contains($str,' ')">
      <xsl:value-of select="substring-after($str,' ')"/>
    </xsl:if>
  </xsl:variable>

  <!-- This works with all namespaces -->
  <xsl:if test="not(string-length(normalize-space($start)) = 0)
  		and not(//iso:diagnostic[@id = $start])
		and not(//sch:diagnostic[@id = $start]) 
		and not(//diagnostic[@id = $start])">
	<xsl:message>Reference error: A diagnostic "<xsl:value-of select="string($start)"
	/>" has been referenced but is not declared</xsl:message>
  </xsl:if>

  <xsl:if test="string-length(normalize-space($start)) > 0">
     <xsl:text> </xsl:text>
     <xsl:apply-templates 
        select="//iso:diagnostic[@id = $start ]
        	| //sch:diagnostic[@id = $start ] 
            | //diagnostic[@id= $start ]"/>
  </xsl:if>

  <xsl:if test="not($end='')">
    <xsl:call-template name="diagnosticsSplit">
     <xsl:with-param name="str" select="$end"/>
    </xsl:call-template>
  </xsl:if>
</xsl:template>

<!-- It would be nice to use this but xsl:namespace does not
  allow a fallback -->
<!--xsl:template name="handle-namespace" version="2.0">
   <xsl:namespace name="{@prefix}" select="@uri">
</xsl:template-->

<xsl:template name="handle-namespace">
       <!-- experimental code from http://eccnet.eccnet.com/pipermail/schematron-love-in/2006-June/000104.html -->
       <!-- Handle namespaces differently for exslt systems, msxml, and default, only using XSLT1 syntax -->
       <!-- For more info see  http://fgeorges.blogspot.com/2007/01/creating-namespace-nodes-in-xslt-10.html -->
       <xsl:choose>
          <!-- The following code works for XSLT1 -->
        <xsl:when test="function-available('exsl:node-set')">
           <xsl:variable name="ns-dummy-elements">
             <xsl:element name="{@prefix}:dummy" namespace="{@uri}"/>
           </xsl:variable>
       	   <xsl:variable name="p" select="@prefix"/>
           <xsl:copy-of select="exsl:node-set($ns-dummy-elements)
                                  /*/namespace::*[local-name()=$p]"/>
         </xsl:when>        

   			<!-- End XSLT1  code -->
  
        <!-- Not tested yet       
    	<xsl:when test="function-available('msxsl:node-set')">
      		<xsl:variable name="ns-dummy-elements">
        		<xsl:element name="{ $prefix }:e" namespace="{ $uri }"/>
      		</xsl:variable>
      		<xsl:copy-of select="msxsl:node-set($ns-dummy-elements)/*/namespace::*"/>
    	</xsl:when>
        -->
        
        <xsl:when test="@prefix = 'xsl' ">
           <!-- Do not generate dummy attributes with the xsl: prefix, as these
                are errors against XSLT, because we presume that the output
                stylesheet uses the xsl prefix. In any case, there would already
                be a namespace declaration for the XSLT namesp     </xsl:message>
        </xsl:when>

        <xsl:otherwise>
          <xsl:attribute name="{concat(@prefix,':dummy-for-xmlns')}" namespace="{@uri}" />
           
        </xsl:otherwise>
      </xsl:choose>


</xsl:template>

<!-- ============================================================== -->
<!-- UNEXPECTED ELEMENTS -->
<!-- ============================================================== -->

	<xsl:template match="iso:*"  priority="-2">
	   <xsl:message>
			<xsl:text>Error: unrecognized element in ISO Schematron namespace: check spelling
			and capitalization</xsl:text>
			<xsl:value-of select="name(.)"/>
		</xsl:sessage>
	</xsl:template>
	
	
	<!-- Swallow old namespace elements: there is an upfront test for them elsewhere -->
	<xsl:template match="sch:*"  priority="-2" />
	
	<xsl:template match="*"  priority="-3">
	    <xsl:choose>
	       <xsl:when test=" $allow-foreign = 'false' ">
				<xsl:message>
					<xsl:text>Warning: unrecognized element </xsl:text>
					<xsl:value-of select="name(.)"/>
				</xsl:message>
			</xsl:when>
			<xsl:otherwise>
				<xsl:copy-of select="." />
			</xsl:otherwise>
		</xsl:choose>
	</xsl:template>
	
	<xsl:template match="iso:*" mode="text" priority="-2" />
	<xsl:template match="*" mode="text" priority="-3">
	    <xsl:choose>
	       <xsl:when test=" $allow-foreign = 'false' ">
				<xsl:message>
					<xsl:text>Warning: unrecognized element </xsl:text>
					<xsl:value-of select="name(.)"/>
				</xsl:message>
			</xsl:when>
			<xsl:otherwise>
				<xsl:copy-of select="." />
			</xsl:otherwise>
		</xsl:choose>
	</xsl:template>

<!-- ========I===================================================== -->
<!-- DEFAULT NAMED TEMPLATES -->
<!-- These are the actions that are performed unless overridden -->
<!-- ============================================================== -->
 
	<xsl:template name="process-prolog"/>
	<!-- no params -->

	<xsl:template name="process-root">
		<xsl:param name="contents"/>
		<xsl:param name="id" />
		<xsl:param name="version" />
		<xsl:param name="schemaVersion" />
		<xsl:param name="queryBinding" />
		<xsl:param name="title" />


		<!-- "Rich" parameters -->
		<xsl:param name="fpi" />
		<xsl:param name="icon" />
		<xsl:param name="lang" />
		<xsl:param name="see" />
		<xsl:param name="space" />

		<xsl:copy-of select="$contents"/>
	</xsl:template>

	<xsl:template name="process-assert">

		<xsl:param name="test"/>
		<xsl:param name="diagnostics" />
		<xsl:param name="id" />
		<xsl:param name="flag" />

           	<!-- "Linkable" parameters -->
		<xsl:param name="role"/>
		<xsl:param name="subject"/>

		<!-- "Rich" parameters -->
		<xsl:param name="fpi" />
		<xsl:param name="icon" />
		<xsl:param name="lang" />
		<xsl:param name="see" />
		<xsl:param name="space" />


		<xsl:call-template name="process-message">
			<xsl:with-param name="pattern" select="$test"/>
			<xsl:with-param name="role" select="$role"/>
		</xsl:call-template>
		
		
	</xsl:template>

	<xsl:template name="process-report">
		<xsl:param name="test"/>
		<xsl:param name="diagnostics" />
		<xsl:param name="id" />
		<xsl:param name="flag" />

           	<!-- "Linkable" parameters -->
		<xsl:param name="role"/>
		<xsl:param name="subject"/>

		<!-- "Rich" parameters -->
		<xsl:param name="fpi" />
		<xsl:param name="icon" /> 
		<xsl:param name="lang" />
		<xsl:param name="see" />
		<xsl:param name="space" />

		<xsl:call-template name="process-message">
			<xsl:with-param name="pattern" select="$test"/>
			<xsl:with-param name="role" select="$role"/>
		</xsl:call-template>
	</xsl:template>

	<xsl:template name="process-diagnostic">
		<xsl:param name="id" />

		<!-- "Rich" parameters -->
		<xsl:param name="fpi" />
		<xsl:param name="icon" />
		<xsl:param name="lang" />
		<xsl:param name="see" />
		<xsl:param name="space" />
		
	    <!-- We generate too much whitespace rather than risking concatenation -->
		<axsl:text> </axsl:text>
		<xsl:apply-templates mode="text"/>
		<axsl:text> </axsl:text>
	</xsl:template>

	<xsl:template name="process-dir">
      	<xsl:param name="value" />

	    <!-- We generate too much whitespace rather than risking concatenation -->
		<axsl:text> </axsl:text>
		<xsl:apply-templates mode="inline-text"/>
		<axsl:text> </axsl:text>
	</xsl:template>

	<xsl:template name="process-emph"> 
	    <!-- We generate too much whitespace rather than risking concatenation -->
		<axsl:text> </axsl:text>
		<xsl:apply-templates mode="inline-text"/>
		<axsl:text> </axsl:text>
	</xsl:template>
	
	<xsl:template name="process-name">
		<xsl:param name="name"/>
		
		<!-- We generate too much whitespace rather than risking concatenation -->
		<axsl:text> </axsl:text>
		<axsl:value-of select="{$name}"/>
		<axsl:text> </axsl:text>
		
    hat process-ns is for reporting. The sch:ns elements are 
	     independently used in the sch:schema template to provide namespace bindings -->
		<xsl:param name="prefix"/>
		<xsl:param name="uri" />
      </xsl:template>

	<xsl:template name="process-p">
		<xsl:param name="id" />
		<xsl:param name="class" />
		<xsl:param name="icon" />
		<xsl:param name="lang" />
      </xsl:template>

	<xsl:template name="process-pattern">
		<xsl:param name="id" />
		<xsl:param name="name" />
		<xsl:param name="is-a" />

		<!-- "Rich" parameters -->
		<xsl:param name="fpi" />
		<xsl:param name="icon" />
		<xsl:param name="lang" />
		<xsl:param name="see" />
		<xsl:param name5"space" />
      </xsl:template>
      

	<xsl:template name="process-rule">
		<xsl:param name="context" />

		<xsl:param name="id" />
		<xsl:param name="flag" />

           	<!-- "Linkable" parameters -->
		<xsl:param name="role"/>
		<xsl:param name="subject"/>
  
		<!-- "Rich" parameters -->
		<xsl:param name="fpi" />
		<xsl:param name="icon" />
		<xsl:param name="lang" />
		<xsl:param name="see" />
		<xsl:param name="space" />
      </xsl:template>

	<xsl:template name="process-span" >
		<xsl:param name="class" />

	    <!-- We generate too much whitespace rather than risking concatenation -->
		<axsl:text> </axsl:text>
		<xsl:apply-templates mode="inline-text"/>
		<axsl:text> </axsl:text>		
	</xsl:template>

	<xsl:template name="process-title" >
		<xsl:param name="class" />
	   lue-of  select="string('&#10;')"/>
		</xsl:if>
		
	</xsl:template>
</xsl: