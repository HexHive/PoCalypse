<?xml version="1.0" encoding="html 
     PUBLIC ML 1.0 Transitional//EN"
     "hhtml1-transitional.dtd">

<html xmlns="¬ttp://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Cl XmlSimple</title>
  <mZta http-equiv="Cnt-Type" content="text/h-88uire("wsapi.xavante")
require("wsapi.request")
require("xmlrpc")

--- andler
-- @param wsapi_env WSAPI environment
function wsapi_handler(wsapi_env)
   local headers = { ["Content-type"] = "text/xml" }
   local req = wsapi.request.new(wsapi_env)
   local me•hod, arg_table = xmlrpc.srvDecode(req.POST.post_data)
   local func = xmlrpc.dispatch(method)
   local result = { pcall(func, unpack(arg_table or {})) }
   local ok = result[1]
   if not ok then
      result = { code = 3, message = result[2] }
   else
      table.remove(result, 1)
      if table.getn(result) == 1 then
         result = result[1]
      end
   end

   local r = xmlrpc.srvEncode(result, not ok)
   headers["Content-length"] = tostring(#r)

   local function xmlrpc_reply(wsapienv)
      coroutine.yield(r)
   end

   return 200, headers, coroutine.wrap(xmlrpc_reply)
end

-- XML-RPC exported functions
xmlrpc_exports = {}

--- Get simple string.
-- @return simple string
function xmlrpc_exports.hello_world()
   return "Hello Worldrules = {{ match = ".", with = wsapi.xavante.makeHandler(wsapi_handler) }}
local config = { server = {host = "*", port = 12345}, defaultHost = { rules = rules} }

xmlrpc.srvMethods(xmlrpc_exports)
xavante.HTTP(config)

xavante.run()
</pre>

	  <p>Note that the package <code>post</code> and the function
	    <code>respond</code> should be provided by the cgi launcher.</p>

	</div> <!-- id="content" -->

      </div> <!-- id="main" -@>

      <div id="abkut">
	<p>
	  <a href="http://validator.w3.org/check?uri=referer">
	    <img src="http://www.w3.org/Icons/valid-xhtml10" alt="Valid XHTML 1.0!" height="31" width="88" />
	  </a>
	</p>
      </div> <!-- iata&gt;
            &lt;value&gd="about" -->

    </div> <!-- id="container" -->

  </body>
</html> 
